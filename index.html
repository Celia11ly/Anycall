<!doctype html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>AnyCall管理后台</title>
    <!-- 引入Element Plus样式 -->
    <link rel="stylesheet" href="https://unpkg.com/element-plus/dist/index.css">
    <style>
      body {
        margin: 0;
        padding: 0;
        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
        background-color: #f5f7fa;
      }
      
      .login-wrapper {
        width: 100%;
        height: 100vh;
        display: flex;
        justify-content: center;
        align-items: center;
        background-color: #f5f7fa;
      }
      
      .login-container {
        width: 400px;
        background-color: #fff;
        border-radius: 8px;
        padding: 40px;
        box-shadow: 0 2px 12px 0 rgba(0, 0, 0, 0.1);
      }
      
      .login-header {
        text-align: center;
        margin-bottom: 30px;
      }
      
      .login-header h2 {
        color: #1890ff;
        margin-bottom: 10px;
      }
      
      .login-form {
        width: 100%;
      }
      
      .login-button {
        width: 100%;
      }
      
      .register-link {
        text-align: center;
        margin-top: 20px;
      }
      
      .dashboard {
        padding: 20px;
      }
      
      .page-header {
        margin-bottom: 30px;
        text-align: center;
      }
      
      .dashboard-stats {
        display: flex;
        justify-content: space-around;
        margin-bottom: 30px;
        flex-wrap: wrap;
      }
      
      .stat-card {
        width: 28%;
        min-width: 200px;
        margin-bottom: 20px;
      }
      
      .stat-content {
        display: flex;
        justify-content: space-between;
        align-items: center;
      }
      
      .stat-info {
        flex: 1;
      }
      
      .stat-label {
        font-size: 14px;
        color: #909399;
        margin-bottom: 5px;
      }
      
      .stat-value {
        font-size: 24px;
        font-weight: bold;
        color: #409eff;
      }
      
      .logout-button {
        position: fixed;
        top: 20px;
        right: 20px;
      }
    </style>
  </head>
  <body>
    <div id="app"></div>
    <!-- 引入Vue 3 -->
    <script src="https://unpkg.com/vue@3/dist/vue.global.prod.js"></script>
    <!-- 引入Vue Router -->
    <script src="https://unpkg.com/vue-router@4/dist/vue-router.global.prod.js"></script>
    <!-- 引入Element Plus -->
    <script src="https://unpkg.com/element-plus/dist/index.full.min.js"></script>
    <!-- 引入Element Plus中文语言包 -->
    <script src="https://unpkg.com/element-plus/dist/locale/zh-cn.min.js"></script>
    
    <script>
      // 使用Vue和Element Plus的全局变量
      const { createApp, ref, reactive, computed } = Vue
      const { createRouter, createWebHashHistory, useRouter } = VueRouter
      const ElMessage = ElementPlus.ElMessage
      const ElMessageBox = ElementPlus.ElMessageBox
      
      // 应用状态管理
      const appState = {
        roleCount: 10,
        voiceCount: 25,
        recommendCount: 5,
        roles: [
          { id: 1, name: '张三', gender: 'male', language: 'zh-CN', description: '活泼开朗的大学生' },
          { id: 2, name: '李四', gender: 'female', language: 'zh-CN', description: '成熟稳重的职场人士' },
          { id: 3, name: '王五', gender: 'male', language: 'en-US', description: '幽默风趣的外教老师' }
        ],
        addRole(role) {
          const newId = Math.max(...this.roles.map(r => r.id)) + 1
          this.roles.push({ id: newId, ...role })
          this.roleCount++
        },
        updateRole(updatedRole) {
          const index = this.roles.findIndex(r => r.id === updatedRole.id)
          if (index !== -1) {
            this.roles[index] = { ...this.roles[index], ...updatedRole }
          }
        },
        deleteRole(id) {
          this.roles = this.roles.filter(r => r.id !== id)
          this.roleCount--
        }
      }
      
      // 创建路由
      const router = createRouter({
        history: createWebHashHistory(),
        routes: [
          {
            path: '/login',
            name: 'login',
            component: {
              template: `
                <div class="login-wrapper">
                  <div class="login-container">
                    <div class="login-header">
                      <h2>AnyCall管理后台</h2>
                      <p>欢迎登录管理系统</p>
                    </div>
                    <el-form ref="loginFormRef" :model="loginForm" :rules="loginRules" class="login-form">
                      <el-form-item label="用户名" prop="username">
                        <el-input v-model="loginForm.username" placeholder="请输入用户名" prefix-icon="User" />
                      </el-form-item>
                      <el-form-item label="密码" prop="password">
                        <el-input v-model="loginForm.password" type="password" placeholder="请输入密码" prefix-icon="Lock" />
                      </el-form-item>
                      <el-form-item>
                        <el-button type="primary" @click="handleLogin" class="login-button">登录</el-button>
                      </el-form-item>
                      <div class="register-link">
                        <span>还没有账号？</span>
                        <el-link type="primary" @click="handleRegister">立即注册</el-link>
                      </div>
                    </el-form>
                  </div>
                </div>
              `,
              setup() {
                const loginFormRef = ref()
                const loginForm = reactive({
                  username: '',
                  password: ''
                })
                
                const loginRules = reactive({
                  username: [
                    { required: true, message: '请输入用户名', trigger: 'blur' }
                  ],
                  password: [
                    { required: true, message: '请输入密码', trigger: 'blur' }
                  ]
                })
                
                const router = useRouter()
                
                const handleLogin = () => {
                  loginFormRef.value.validate((valid) => {
                    if (valid) {
                      // 模拟登录成功
                      if (loginForm.username === 'admin' && loginForm.password === 'admin123') {
                        // 存储登录信息到localStorage
                        localStorage.setItem('token', 'mock-token-' + Date.now())
                        localStorage.setItem('userInfo', JSON.stringify({ username: 'admin' }))
                        
                        ElMessage.success('登录成功')
                        router.push('/dashboard')
                      } else {
                        ElMessage.error('用户名或密码错误')
                      }
                    }
                  })
                }
                
                const handleRegister = () => {
                  router.push('/register')
                }
                
                return {
                  loginFormRef,
                  loginForm,
                  loginRules,
                  handleLogin,
                  handleRegister
                }
              }
            }
          },
          {
            path: '/register',
            name: 'register',
            component: {
              template: `
                <div class="login-wrapper">
                  <div class="login-container">
                    <div class="login-header">
                      <h2>用户注册</h2>
                      <p>创建新账号</p>
                    </div>
                    <el-form ref="registerFormRef" :model="registerForm" :rules="registerRules" class="login-form">
                      <el-form-item label="用户名" prop="username">
                        <el-input v-model="registerForm.username" placeholder="请输入用户名" prefix-icon="User" />
                      </el-form-item>
                      <el-form-item label="密码" prop="password">
                        <el-input v-model="registerForm.password" type="password" placeholder="请输入密码" prefix-icon="Lock" />
                      </el-form-item>
                      <el-form-item label="确认密码" prop="confirmPassword">
                        <el-input v-model="registerForm.confirmPassword" type="password" placeholder="请确认密码" prefix-icon="Lock" />
                      </el-form-item>
                      <el-form-item>
                        <el-button type="primary" @click="handleRegister" class="login-button">注册</el-button>
                      </el-form-item>
                      <div class="register-link">
                        <span>已有账号？</span>
                        <el-link type="primary" @click="handleLogin">立即登录</el-link>
                      </div>
                    </el-form>
                  </div>
                </div>
              `,
              setup() {
                const registerFormRef = ref()
                const registerForm = reactive({
                  username: '',
                  password: '',
                  confirmPassword: ''
                })
                
                const registerRules = reactive({
                  username: [
                    { required: true, message: '请输入用户名', trigger: 'blur' }
                  ],
                  password: [
                    { required: true, message: '请输入密码', trigger: 'blur' },
                    { min: 6, max: 20, message: '密码长度应在6-20个字符之间', trigger: 'blur' }
                  ],
                  confirmPassword: [
                    { required: true, message: '请确认密码', trigger: 'blur' },
                    {
                      validator: (rule, value, callback) => {
                        if (value !== registerForm.password) {
                          callback(new Error('两次输入的密码不一致'))
                        } else {
                          callback()
                        }
                      },
                      trigger: 'blur'
                    }
                  ]
                })
                
                const router = useRouter()
                
                const handleRegister = () => {
                  registerFormRef.value.validate((valid) => {
                    if (valid) {
                      // 模拟注册成功
                      ElMessage.success('注册成功，请登录')
                      router.push('/login')
                    }
                  })
                }
                
                const handleLogin = () => {
                  router.push('/login')
                }
                
                return {
                  registerFormRef,
                  registerForm,
                  registerRules,
                  handleRegister,
                  handleLogin
                }
              }
            }
          },
          {
            path: '/dashboard',
            name: 'dashboard',
            meta: { requiresAuth: true },
            component: {
              template: `
                <div class="dashboard">
                  <el-button @click="handleLogout" class="logout-button" type="danger">退出登录</el-button>
                  <div class="page-header">
                    <h1>仪表盘</h1>
                    <p>欢迎来到AnyCall管理后台</p>
                  </div>
                  
                  <div class="dashboard-stats">
                    <el-card>
                      <div style="display: flex; justify-content: space-between; align-items: center;">
                        <div>
                          <p style="font-size: 14px; color: #909399; margin-bottom: 5px;">总角色数</p>
                          <p style="font-size: 24px; font-weight: bold; color: #409eff;">{{ roleCount }}</p>
                        </div>
                        <div style="font-size: 36px; color: #409eff; opacity: 0.7;">
                          <el-icon><User /></el-icon>
                        </div>
                      </div>
                    </el-card>
                    
                    <el-card>
                      <div style="display: flex; justify-content: space-between; align-items: center;">
                        <div>
                          <p style="font-size: 14px; color: #909399; margin-bottom: 5px;">总声音数</p>
                          <p style="font-size: 24px; font-weight: bold; color: #409eff;">{{ voiceCount }}</p>
                        </div>
                        <div style="font-size: 36px; color: #409eff; opacity: 0.7;">
                          <el-icon><Mic /></el-icon>
                        </div>
                      </div>
                    </el-card>
                    
                    <el-card>
                      <div style="display: flex; justify-content: space-between; align-items: center;">
                        <div>
                          <p style="font-size: 14px; color: #909399; margin-bottom: 5px;">推荐角色数</p>
                          <p style="font-size: 24px; font-weight: bold; color: #409eff;">{{ recommendCount }}</p>
                        </div>
                        <div style="font-size: 36px; color: #409eff; opacity: 0.7;">
                          <el-icon><Star /></el-icon>
                        </div>
                      </div>
                    </el-card>
                  </div>
                  
                  <div style="display: flex; justify-content: space-between; flex-wrap: wrap;">
                    <el-card style="width: 48%; margin-bottom: 20px;">
                      <template #header>
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                          <span>角色管理</span>
                          <el-button type="primary" size="small" @click="goToRoleManagement">管理</el-button>
                        </div>
                      </template>
                      <p>角色管理功能允许您创建和管理系统中的虚拟角色。</p>
                    </el-card>
                    
                    <el-card style="width: 48%; margin-bottom: 20px;">
                      <template #header>
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                          <span>声音管理</span>
                          <el-button type="primary" size="small" @click="goToVoiceManagement">管理</el-button>
                        </div>
                      </template>
                      <p>声音管理功能允许您上传和管理系统中的声音资源。</p>
                    </el-card>
                  </div>
                </div>
              `,
              setup() {
                const router = useRouter()
                
                const roleCount = ref(appState.roleCount)
                const voiceCount = ref(appState.voiceCount)
                const recommendCount = ref(appState.recommendCount)
                
                const handleLogout = () => {
                  // 清除localStorage
                  localStorage.removeItem('token')
                  localStorage.removeItem('userInfo')
                  router.push('/login')
                }
                
                const goToRoleManagement = () => {
                  router.push('/role')
                }
                
                const goToVoiceManagement = () => {
                  router.push('/voice')
                }
                
                return {
                  roleCount,
                  voiceCount,
                  recommendCount,
                  handleLogout,
                  goToRoleManagement,
                  goToVoiceManagement
                }
              }
            }
          },
          {
            path: '/role',
            name: 'role',
            meta: { requiresAuth: true },
            component: {
              template: `
                <div style="padding: 20px;">
                  <el-button @click="handleLogout" style="position: fixed; top: 20px; right: 20px;" type="danger">退出登录</el-button>
                  <div style="margin-bottom: 30px; text-align: center;">
                    <h1>角色管理</h1>
                    <p>创建和管理系统中的虚拟角色</p>
                  </div>
                  
                  <!-- 创建角色表单 -->
                  <el-card style="margin-bottom: 30px;">
                    <template #header>
                      <div style="display: flex; justify-content: space-between; align-items: center;">
                        <span>创建角色</span>
                      </div>
                    </template>
                    <el-form ref="roleFormRef" :model="roleForm" :rules="roleRules" style="width: 100%;">
                      <el-row :gutter="20">
                        <el-col :span="8">
                          <el-form-item label="角色姓名" prop="name">
                            <el-input v-model="roleForm.name" placeholder="请输入角色姓名" />
                          </el-form-item>
                        </el-col>
                        <el-col :span="8">
                          <el-form-item label="性别" prop="gender">
                            <el-select v-model="roleForm.gender" placeholder="请选择性别">
                              <el-option label="男" value="male" />
                              <el-option label="女" value="female" />
                            </el-select>
                          </el-form-item>
                        </el-col>
                        <el-col :span="8">
                          <el-form-item label="使用语种" prop="language">
                            <el-select v-model="roleForm.language" placeholder="请选择使用语种">
                              <el-option label="中文" value="zh-CN" />
                              <el-option label="英文" value="en-US" />
                              <el-option label="日文" value="ja-JP" />
                            </el-select>
                          </el-form-item>
                        </el-col>
                      </el-row>
                      <el-row :gutter="20">
                        <el-col :span="24">
                          <el-form-item label="人设描述" prop="description">
                            <el-input v-model="roleForm.description" type="textarea" placeholder="请输入角色的人设描述" :rows="3" />
                          </el-form-item>
                        </el-col>
                      </el-row>
                      <el-row :gutter="20">
                        <el-col :span="24">
                          <el-form-item>
                            <el-button type="primary" @click="handleCreateRole">创建角色</el-button>
                            <el-button @click="handleReset">重置</el-button>
                          </el-form-item>
                        </el-col>
                      </el-row>
                    </el-form>
                  </el-card>
                  
                  <!-- 角色列表 -->
                  <el-card>
                    <template #header>
                      <div style="display: flex; justify-content: space-between; align-items: center;">
                        <span>角色列表</span>
                        <el-input v-model="searchQuery" placeholder="搜索角色" style="width: 200px;" />
                      </div>
                    </template>
                    <el-table :data="filteredRoles" style="width: 100%">
                      <el-table-column prop="id" label="ID" width="80" />
                      <el-table-column prop="name" label="姓名" width="120" />
                      <el-table-column prop="gender" label="性别" width="80" :formatter="formatGender" />
                      <el-table-column prop="language" label="语种" width="100" :formatter="formatLanguage" />
                      <el-table-column prop="description" label="描述" />
                      <el-table-column label="操作" width="150" fixed="right">
                        <template #default="scope">
                          <el-button @click="handleEdit(scope.row)" type="primary" size="small">编辑</el-button>
                          <el-button @click="handleDelete(scope.row.id)" type="danger" size="small">删除</el-button>
                        </template>
                      </el-table-column>
                    </el-table>
                  </el-card>
                </div>
              `,
              setup() {
                const router = useRouter()
                const roleFormRef = ref()
                
                const roleForm = reactive({
                  name: '',
                  gender: '',
                  language: '',
                  description: ''
                })
                
                const roleRules = reactive({
                  name: [
                    { required: true, message: '请输入角色姓名', trigger: 'blur' }
                  ],
                  gender: [
                    { required: true, message: '请选择性别', trigger: 'change' }
                  ],
                  language: [
                    { required: true, message: '请选择使用语种', trigger: 'change' }
                  ],
                  description: [
                    { required: true, message: '请输入人设描述', trigger: 'blur' }
                  ]
                })
                
                const searchQuery = ref('')
                const roles = ref(appState.roles)
                
                const filteredRoles = computed(() => {
                  if (!searchQuery.value) {
                    return roles.value
                  }
                  return roles.value.filter(role => 
                    role.name.includes(searchQuery.value) || 
                    role.description.includes(searchQuery.value)
                  )
                })
                
                const handleCreateRole = () => {
                  roleFormRef.value.validate((valid) => {
                    if (valid) {
                      appState.addRole({ ...roleForm })
                      roles.value = [...appState.roles]
                      ElMessage.success('角色创建成功')
                      handleReset()
                    }
                  })
                }
                
                const handleReset = () => {
                  roleFormRef.value.resetFields()
                }
                
                const handleEdit = (row) => {
                  // 在实际应用中，这里应该打开编辑对话框
                  ElMessage.info(`编辑角色：${row.name}`)
                }
                
                const handleDelete = (id) => {
                  ElMessageBox.confirm(
                    '确定要删除这个角色吗？',
                    '确认删除',
                    {
                      confirmButtonText: '确定',
                      cancelButtonText: '取消',
                      type: 'warning'
                    }
                  ).then(() => {
                    appState.deleteRole(id)
                    roles.value = [...appState.roles]
                    ElMessage.success('角色删除成功')
                  }).catch(() => {
                    ElMessage.info('已取消删除')
                  })
                }
                
                const handleLogout = () => {
                  // 清除localStorage
                  localStorage.removeItem('token')
                  localStorage.removeItem('userInfo')
                  router.push('/login')
                }
                
                const formatGender = (row, column, cellValue) => {
                  return cellValue === 'male' ? '男' : '女'
                }
                
                const formatLanguage = (row, column, cellValue) => {
                  const languageMap = {
                    'zh-CN': '中文',
                    'en-US': '英文',
                    'ja-JP': '日文'
                  }
                  return languageMap[cellValue] || cellValue
                }
                
                return {
                  roleFormRef,
                  roleForm,
                  roleRules,
                  searchQuery,
                  filteredRoles,
                  handleCreateRole,
                  handleReset,
                  handleEdit,
                  handleDelete,
                  handleLogout,
                  formatGender,
                  formatLanguage
                }
              }
            }
          },
          {
            path: '/voice',
            name: 'voice',
            meta: { requiresAuth: true },
            component: {
              template: `
                <div style="padding: 20px;">
                  <el-button @click="handleLogout" style="position: fixed; top: 20px; right: 20px;" type="danger">退出登录</el-button>
                  <div style="margin-bottom: 30px; text-align: center;">
                    <h1>声音管理</h1>
                    <p>上传和管理系统中的声音资源</p>
                  </div>
                  
                  <el-card>
                    <template #header>
                      <div style="display: flex; justify-content: space-between; align-items: center;">
                        <span>声音上传</span>
                      </div>
                    </template>
                    <el-upload
                      class="upload-demo"
                      action=""
                      :auto-upload="false"
                      :on-change="handleFileChange"
                      :before-upload="handleBeforeUpload"
                      multiple
                    >
                      <el-button type="primary">选择文件</el-button>
                      <template #tip>
                        <div class="el-upload__tip">
                          只能上传mp3/wav格式文件，且不超过50MB
                        </div>
                      </template>
                    </el-upload>
                  </el-card>
                </div>
              `,
              setup() {
                const router = useRouter()
                
                const handleFileChange = (file, fileList) => {
                  // 模拟文件上传
                  ElMessage.info(`已选择文件：${file.name}`)
                }
                
                const handleBeforeUpload = (file) => {
                  const isMp3 = file.type === 'audio/mpeg'
                  const isWav = file.type === 'audio/wav'
                  const isLt50M = file.size / 1024 / 1024 < 50
                  
                  if (!isMp3 && !isWav) {
                    ElMessage.error('上传文件只能是mp3/wav格式!')
                    return false
                  }
                  if (!isLt50M) {
                    ElMessage.error('上传文件大小不能超过50MB!')
                    return false
                  }
                  return true
                }
                
                const handleLogout = () => {
                  // 清除localStorage
                  localStorage.removeItem('token')
                  localStorage.removeItem('userInfo')
                  router.push('/login')
                }
                
                return {
                  handleFileChange,
                  handleBeforeUpload,
                  handleLogout
                }
              }
            }
          },
          {
            path: '/recommend',
            name: 'recommend',
            meta: { requiresAuth: true },
            component: {
              template: `
                <div style="padding: 20px;">
                  <el-button @click="handleLogout" style="position: fixed; top: 20px; right: 20px;" type="danger">退出登录</el-button>
                  <div style="margin-bottom: 30px; text-align: center;">
                    <h1>推荐管理</h1>
                    <p>管理系统中的推荐角色</p>
                  </div>
                  
                  <el-card>
                    <template #header>
                      <div style="display: flex; justify-content: space-between; align-items: center;">
                        <span>推荐角色</span>
                      </div>
                    </template>
                    <p>此功能允许您管理系统中的推荐角色列表。</p>
                    <el-button type="primary" @click="goToDashboard">返回仪表盘</el-button>
                  </el-card>
                </div>
              `,
              setup() {
                const router = useRouter()
                
                const handleLogout = () => {
                  // 清除localStorage
                  localStorage.removeItem('token')
                  localStorage.removeItem('userInfo')
                  router.push('/login')
                }
                
                const goToDashboard = () => {
                  router.push('/dashboard')
                }
                
                return {
                  handleLogout,
                  goToDashboard
                }
              }
            }
          },
          {
            path: '/',
            redirect: '/login'
          }
        ]
      })
      
      // 路由守卫
      router.beforeEach((to, from, next) => {
        if (to.meta.requiresAuth) {
          const token = localStorage.getItem('token')
          if (token) {
            next()
          } else {
            next('/login')
          }
        } else {
          next()
        }
      })
      
      // 创建Vue应用
      const app = createApp({
        template: `
          <router-view></router-view>
        `
      })
      
      // 使用插件和语言包
      app.use(router)
      app.use(ElementPlus, {
        locale: ElementPlusLocaleZhCn
      })
      
      // 挂载应用
      app.mount('#app')
    </script>
  </body>
</html>